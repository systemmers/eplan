"""
데이터베이스 초기화 및 초기 데이터 생성 스크립트
"""
from app import create_app, db
from app.models import User, Category, Post

def init_database():
    app = create_app('development')
    
    with app.app_context():
        # 데이터베이스 테이블 생성
        print('데이터베이스 테이블 생성 중...')
        db.create_all()
        
        # 기존 데이터 확인
        if User.query.first():
            print('이미 데이터가 존재합니다.')
            return
        
        # 관리자 계정 생성
        print('관리자 계정 생성 중...')
        admin = User(
            username='admin',
            email='admin@eplando.com'
        )
        admin.set_password('admin123')  # 프로덕션에서는 반드시 변경해야 함
        db.session.add(admin)
        
        # 카테고리 생성
        print('카테고리 생성 중...')
        categories = [
            Category(name='공지사항', slug='notice'),
            Category(name='뉴스', slug='news'),
            Category(name='영어', slug='english'),
            Category(name='일본어', slug='japanese'),
            Category(name='중국어', slug='chinese')
        ]
        for cat in categories:
            db.session.add(cat)
        
        db.session.commit()
        
        # 샘플 게시글 생성
        print('샘플 게시글 생성 중...')
        notice_cat = Category.query.filter_by(slug='notice').first()
        news_cat = Category.query.filter_by(slug='news').first()
        english_cat = Category.query.filter_by(slug='english').first()
        japanese_cat = Category.query.filter_by(slug='japanese').first()
        chinese_cat = Category.query.filter_by(slug='chinese').first()
        
        sample_posts = []
        
        # 공지사항 (12개)
        notices = [
            ('ePlan 웹사이트 오픈을 환영합니다', '<p>ePlan의 새로운 웹사이트가 오픈했습니다.</p><p>앞으로 더욱 향상된 서비스로 여러분을 찾아뵙겠습니다.</p>'),
            ('2025년 전화영어 프로그램 안내', '<p>2025년 새로운 전화영어 프로그램을 안내드립니다.</p><p>다양한 레벨과 코스로 여러분의 영어 실력 향상을 돕겠습니다.</p>'),
            ('신학기 특별 할인 프로모션', '<p>3월 한 달간 전화영어 신규 등록 시 20% 할인 혜택을 제공합니다.</p><p>이 기회를 놓치지 마세요!</p>'),
            ('기업출강 프로그램 확대 안내', '<p>기업 맞춤형 어학교육 프로그램을 확대 운영합니다.</p><p>문의사항은 컨설팅 문의 페이지를 이용해주세요.</p>'),
            ('여름방학 집중과정 모집', '<p>7-8월 여름방학 기간 집중과정을 운영합니다.</p><p>단기간에 영어 실력을 향상시킬 수 있는 좋은 기회입니다.</p>'),
            ('추석 연휴 휴무 안내', '<p>추석 연휴 기간 (9월 28일-30일) 고객센터가 휴무입니다.</p><p>연휴 기간에도 온라인 수업은 정상 진행됩니다.</p>'),
            ('새로운 교재 출시 안내', '<p>2025년 개정판 교재가 출시되었습니다.</p><p>최신 트렌드를 반영한 실용적인 내용으로 구성되었습니다.</p>'),
            ('시스템 점검 안내', '<p>12월 15일 오전 2시-6시 시스템 정기 점검이 있습니다.</p><p>해당 시간에는 웹사이트 이용이 제한될 수 있습니다.</p>'),
            ('연말연시 수강 혜택 안내', '<p>12월 한 달간 장기 수강 등록 시 추가 할인 혜택을 제공합니다.</p><p>최대 30% 할인 가능합니다.</p>'),
            ('모바일 앱 업데이트', '<p>ePlan 모바일 앱이 새롭게 업데이트되었습니다.</p><p>더욱 편리해진 인터페이스를 경험해보세요.</p>'),
            ('2025년 정규 휴무일 안내', '<p>2025년 정규 휴무일을 안내드립니다.</p><p>설날, 추석 연휴 및 공휴일에는 고객센터가 휴무합니다.</p>'),
            ('강사 채용 공고', '<p>경력 원어민 강사를 모집합니다.</p><p>자세한 내용은 강사지원 페이지를 참고해주세요.</p>')
        ]
        
        for title, content in notices:
            sample_posts.append(Post(
                title=title,
                content=content,
                category_id=notice_cat.id,
                author_id=admin.id,
                is_published=True
            ))
        
        # 뉴스 (12개)
        news = [
            ('기업 어학교육 성공 사례', '<p>ePlan의 기업 출강 프로그램을 통해 많은 기업이 글로벌 역량을 강화하고 있습니다.</p><p>S전자의 경우 임직원 영어 능력이 평균 2레벨 향상되었습니다.</p>'),
            ('새로운 강사진 소개', '<p>경험 많은 원어민 강사진이 ePlan에 합류했습니다.</p><p>하버드, 옥스퍼드 출신 강사들이 포함되어 있습니다.</p>'),
            ('토익스피킹 고득점 달성 비법', '<p>ePlan 수강생들의 토익스피킹 평균 점수가 20점 상승했습니다.</p><p>체계적인 학습 방법이 주효했다는 평가입니다.</p>'),
            ('글로벌 인재 양성 프로그램 론칭', '<p>대기업 주재원 대상 특화 프로그램이 시작됩니다.</p><p>현지 적응부터 비즈니스 영어까지 종합 지원합니다.</p>'),
            ('AI 발음 교정 시스템 도입', '<p>최신 AI 기술을 활용한 발음 교정 시스템을 도입했습니다.</p><p>실시간 피드백으로 더욱 효과적인 학습이 가능합니다.</p>'),
            ('여름 특강 성황리 종료', '<p>8주간 진행된 여름 집중 특강이 성공적으로 마무리되었습니다.</p><p>참가자 만족도 95% 이상을 기록했습니다.</p>'),
            ('파트너십 체결 소식', '<p>글로벌 교육기관과 파트너십을 체결했습니다.</p><p>해외 연수 프로그램 연계가 가능해졌습니다.</p>'),
            ('온라인 학습 플랫폼 개편', '<p>학습자 편의성을 높인 새로운 온라인 플랫폼이 오픈했습니다.</p><p>모바일 최적화로 언제 어디서나 학습 가능합니다.</p>'),
            ('수강생 해외 취업 성공 사례', '<p>ePlan 수강생이 외국계 기업에 합격했습니다.</p><p>체계적인 비즈니스 영어 학습이 성공의 열쇠였습니다.</p>'),
            ('코로나19 대응 안전 수업 운영', '<p>철저한 방역 관리로 안전한 학습 환경을 제공합니다.</p><p>비대면 화상 수업도 동시 운영 중입니다.</p>'),
            ('교육 품질 인증 획득', '<p>ePlan이 국제 교육 품질 인증을 획득했습니다.</p><p>체계적인 커리큘럼과 우수한 강사진을 인정받았습니다.</p>'),
            ('신규 학습센터 오픈', '<p>강남에 새로운 학습센터가 오픈했습니다.</p><p>최신 시설과 편안한 학습 공간을 제공합니다.</p>')
        ]
        
        for title, content in news:
            sample_posts.append(Post(
                title=title,
                content=content,
                category_id=news_cat.id,
                author_id=admin.id,
                is_published=True
            ))
        
        # 영어 학습 팁 (15개)
        english_tips = [
            ('영어 회화 실력을 빠르게 향상시키는 5가지 방법', '<p>1. 매일 10분 영어 일기 쓰기<br>2. 원어민과 대화 기회 만들기<br>3. 영어 드라마 자막 없이 보기<br>4. 쉐도잉(Shadowing) 연습하기<br>5. 영어로 생각하는 습관 들이기</p><p>꾸준히 실천하면 3개월 내에 눈에 띄는 향상을 경험할 수 있습니다.</p>'),
            ('비즈니스 이메일 작성 팁', '<p>영어 비즈니스 이메일의 기본 구조와 자주 사용되는 표현을 소개합니다.</p><p>Subject line 작성법부터 closing remarks까지 실무에서 바로 활용할 수 있는 템플릿을 제공합니다.</p>'),
            ('효과적인 영어 프레젠테이션 준비하기', '<p>청중을 사로잡는 영어 프레젠테이션의 비결을 알려드립니다.</p><p>Opening부터 Q&A까지 단계별 준비 가이드와 필수 표현을 정리했습니다.</p>'),
            ('헷갈리는 영어 문법 정복하기', '<p>한국인이 자주 틀리는 영어 문법 TOP 10을 정리했습니다.</p><p>시제, 관사, 전치사 사용법을 쉽게 이해할 수 있도록 설명합니다.</p>'),
            ('원어민처럼 자연스러운 영어 표현', '<p>교과서에서 배우지 못한 일상 영어 표현을 소개합니다.</p><p>슬랭과 관용어를 적절히 사용하여 더욱 유창한 회화가 가능해집니다.</p>'),
            ('영어 듣기 실력 향상 전략', '<p>듣기 실력이 늘지 않는다면 이 방법을 시도해보세요.</p><p>Podcast, YouTube, Audiobook을 활용한 단계별 학습법을 소개합니다.</p>'),
            ('영어 발음 교정의 모든 것', '<p>정확한 발음은 효과적인 의사소통의 핵심입니다.</p><p>한국인이 어려워하는 발음과 교정 방법을 상세히 설명합니다.</p>'),
            ('영어 어휘력 확장 노하우', '<p>단어를 많이 외워도 실전에서 사용하지 못한다면?</p><p>문맥 속에서 어휘를 자연스럽게 습득하는 방법을 알려드립니다.</p>'),
            ('영어 전화 회의 완벽 가이드', '<p>글로벌 비즈니스 환경에서 필수인 영어 전화 회의.</p><p>의견 제시, 동의/반대 표현, 회의 진행 표현을 정리했습니다.</p>'),
            ('영어 면접 준비 완벽 가이드', '<p>외국계 기업 면접을 준비하시나요?</p><p>자주 나오는 질문과 모범 답변 예시를 제공합니다.</p>'),
            ('영어 작문 실력 높이기', '<p>논리적이고 설득력 있는 영어 글쓰기 방법을 배웁니다.</p><p>Paragraph 구조부터 Transition words 사용법까지 상세 설명합니다.</p>'),
            ('영어 뉴스로 공부하는 법', '<p>CNN, BBC 뉴스를 활용한 영어 학습 전략을 소개합니다.</p><p>시사 영어 표현과 배경 지식을 동시에 습득할 수 있습니다.</p>'),
            ('영어 학습 플래너 작성법', '<p>목표 설정부터 일일 학습 계획까지 체계적으로 관리하세요.</p><p>효율적인 영어 학습을 위한 플래너 템플릿을 제공합니다.</p>'),
            ('원어민과 대화할 때 주의할 점', '<p>문화적 차이를 이해하고 적절한 표현을 사용하는 것이 중요합니다.</p><p>Small talk부터 비즈니스 대화까지 상황별 에티켓을 소개합니다.</p>'),
            ('영어 독해 속도 높이기', '<p>빠르고 정확한 독해는 시험과 실무 모두에서 중요합니다.</p><p>Skimming과 Scanning 기법을 활용한 전략적 독해법을 알려드립니다.</p>')
        ]
        
        for title, content in english_tips:
            sample_posts.append(Post(
                title=title,
                content=content,
                category_id=english_cat.id,
                author_id=admin.id,
                is_published=True
            ))
        
        # 일본어 학습 팁 (12개)
        japanese_tips = [
            ('일본어 기초 회화 표현 모음', '<p>일본 여행이나 비즈니스에서 자주 사용되는 기본 회화 표현을 정리했습니다.</p><p>인사말부터 감사 표현까지 상황별로 분류하여 제공합니다.</p>'),
            ('히라가나 가타카나 완벽 마스터', '<p>일본어 학습의 첫 단계인 히라가나와 가타카나를 효과적으로 암기하는 방법을 소개합니다.</p><p>발음 규칙과 쓰기 순서를 함께 학습할 수 있습니다.</p>'),
            ('일본어 경어 사용법 가이드', '<p>일본어의 존경어, 겸양어, 정중어를 상황에 맞게 사용하는 법을 배웁니다.</p><p>비즈니스 일본어의 핵심인 경어 표현을 정리했습니다.</p>'),
            ('JLPT N3 합격 전략', '<p>일본어능력시험 N3 레벨 합격을 위한 학습 전략을 공유합니다.</p><p>문법, 어휘, 독해, 청해 영역별 학습 방법을 제시합니다.</p>'),
            ('일본 문화 이해하기', '<p>일본어를 배우며 알아야 할 일본 문화와 관습을 소개합니다.</p><p>문화적 배경을 이해하면 언어 학습이 더욱 즐거워집니다.</p>'),
            ('일본어 한자 효과적으로 외우기', '<p>한자 학습이 어렵다면 이 방법을 시도해보세요.</p><p>부수와 음독/훈독을 활용한 체계적인 암기법을 소개합니다.</p>'),
            ('일본어 비즈니스 이메일 작성법', '<p>일본 기업과의 비즈니스 이메일 작성 시 주의사항과 예시를 제공합니다.</p><p>정중한 표현과 비즈니스 용어를 정리했습니다.</p>'),
            ('일본어 발음 완벽 가이드', '<p>한국인이 어려워하는 일본어 발음을 집중 공략합니다.</p><p>억양과 강세까지 자연스러운 발음을 위한 팁을 알려드립니다.</p>'),
            ('일본 애니메이션으로 공부하기', '<p>재미있게 일본어를 배울 수 있는 애니메이션 추천 리스트를 제공합니다.</p><p>일상 표현부터 속어까지 자연스럽게 습득할 수 있습니다.</p>'),
            ('일본어 조사 완벽 정리', '<p>は/が, を/に 등 헷갈리는 조사 사용법을 명확하게 정리했습니다.</p><p>예문과 함께 이해하기 쉽게 설명합니다.</p>'),
            ('일본 취업 준비 가이드', '<p>일본 기업 취업을 준비하는 분들을 위한 가이드입니다.</p><p>이력서 작성부터 면접 준비까지 단계별로 안내합니다.</p>'),
            ('일본어 듣기 실력 향상 방법', '<p>일본어 듣기 능력을 효과적으로 향상시키는 학습 전략을 소개합니다.</p><p>NHK 뉴스, 드라마, 팟캐스트 활용법을 정리했습니다.</p>')
        ]
        
        for title, content in japanese_tips:
            sample_posts.append(Post(
                title=title,
                content=content,
                category_id=japanese_cat.id,
                author_id=admin.id,
                is_published=True
            ))
        
        # 중국어 학습 팁 (12개)
        chinese_tips = [
            ('중국어 성조 완벽 마스터', '<p>중국어의 가장 큰 난관인 성조를 정복하는 방법을 알려드립니다.</p><p>4성과 경성의 차이를 이해하고 정확하게 발음하는 연습법을 소개합니다.</p>'),
            ('중국어 간체자 vs 번체자', '<p>간체자와 번체자의 차이와 각각의 사용 지역을 정리했습니다.</p><p>비즈니스 목적에 맞는 문자 선택 가이드를 제공합니다.</p>'),
            ('HSK 시험 준비 전략', '<p>HSK 각 급수별 특징과 효과적인 준비 방법을 소개합니다.</p><p>단기간에 점수를 올릴 수 있는 학습 전략을 공유합니다.</p>'),
            ('중국어 비즈니스 회화 필수 표현', '<p>중국 기업과의 비즈니스에서 자주 사용되는 표현을 정리했습니다.</p><p>협상, 회의, 프레젠테이션 상황별 표현을 제공합니다.</p>'),
            ('중국 문화와 에티켓 이해하기', '<p>중국과의 비즈니스에서 알아야 할 문화와 관습을 소개합니다.</p><p>관시(關係) 문화부터 식사 예절까지 상세히 설명합니다.</p>'),
            ('중국어 한자 효과적으로 암기하기', '<p>방대한 중국어 한자를 체계적으로 학습하는 방법을 알려드립니다.</p><p>부수와 어원을 활용한 연상 암기법을 소개합니다.</p>'),
            ('중국어 듣기 능력 향상 팁', '<p>중국어 듣기 실력을 빠르게 향상시키는 학습 자료와 방법을 제공합니다.</p><p>표준어(보통화)와 방언의 차이도 함께 설명합니다.</p>'),
            ('중국어 작문 잘하는 법', '<p>논리적이고 자연스러운 중국어 글쓰기 방법을 배웁니다.</p><p>이메일부터 보고서까지 다양한 형식의 작문 팁을 제공합니다.</p>'),
            ('중국어 발음 교정 가이드', '<p>한국인이 어려워하는 zh/ch/sh, j/q/x 발음을 집중 연습합니다.</p><p>발음 기호(병음)를 정확하게 읽는 방법도 함께 학습합니다.</p>'),
            ('중국 드라마로 공부하기', '<p>재미있게 중국어를 배울 수 있는 인기 드라마를 추천합니다.</p><p>일상 표현과 현대 중국어를 자연스럽게 익힐 수 있습니다.</p>'),
            ('중국어 면접 준비 완벽 가이드', '<p>중국 기업 또는 중국계 기업 면접을 준비하는 분들을 위한 가이드입니다.</p><p>자주 나오는 질문과 모범 답변 예시를 제공합니다.</p>'),
            ('중국어 속담과 성어 배우기', '<p>중국인들이 일상에서 자주 사용하는 속담과 성어를 소개합니다.</p><p>문화적 배경과 함께 이해하면 더욱 효과적으로 학습할 수 있습니다.</p>')
        ]
        
        for title, content in chinese_tips:
            sample_posts.append(Post(
                title=title,
                content=content,
                category_id=chinese_cat.id,
                author_id=admin.id,
                is_published=True
            ))
        
        # 모든 게시글 저장
        for post in sample_posts:
            db.session.add(post)
        
        db.session.commit()
        
        print(f'총 {len(sample_posts)}개의 샘플 게시글이 생성되었습니다.')
        
        print('데이터베이스 초기화 완료!')
        print('\n=== 초기 로그인 정보 ===')
        print('사용자명: admin')
        print('비밀번호: admin123')
        print('URL: http://localhost:5000/auth/login')
        print('=' * 30)


if __name__ == '__main__':
    init_database()

